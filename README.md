# jlab-script-plus2 Beta3
jlab-script-plus2 は実況ろだ向け（とは言うものの一般向けアップローダーでも使える）アップローダースクリプトです。  
Native PHPとNative Javascriptでコーディングされている為、軽量かつ高速なアップローダーを簡単に構築することができます。  
画像は設定した期間保存され、保存期間を過ぎた画像は自動的に削除されるため、半自動でアップローダーを運用することができます。  

**Beta版の為、不具合が存在する場合があります**  

## Beta3 概要
- masal64さんによる不具合修正・パフォーマンス向上
- 非効率なコードの見直し
- トップページの一部デザイン変更
- Redisサポート

## 必要環境
- PHP 8.1 以上
- PHP-GDライブラリ
- nginx 1.11.0以上 + php-fpm または Apache 2.3以上
 - レンタルサーバー等で稼働予定の場合はここは気にしなくても問題無いです。
- Redis 7.2以上 + phpredis(推奨)

## ダウンロード
右上の **Code** から **Download ZIP** を選択してスクリプト一式をダウンロードしてください。

## ファイル・ディレクトリ一覧
初期設定では以下の通りにファイル、ディレクトリを設置することにより動作します。  
d,s,tフォルダ（フォルダ名は **manage.php** で変更可能）は各自で作成してください。  
[707] は推奨パーミッションを表しています。（サーバにより推奨の設定は異なります。）index.htmlが生成できないエラーが表示された場合は、この親フォルダのパーミッションを一時的に変更することにより正常に動作します。

- /s *[707]*
- /d *[707]*
- /t *[707]*
- /static
- /application
- custom-html.php
- manage.php

## 設置方法
1. **manage.php** を開いて各項目を設定します。
2. すべてのファイル・ディレクトリを稼働させる環境に設置します。
3. ブラウザから **manage.php** にアクセスしてアップローダートップページが表示され、ホームディレクトリに **master.js** と **index.html** が配置されていれば設置完了です。

## 設定の変更方法
1. ホームディレクトリに配置されている **master.js** と **index.html** を削除します。
2. **manage.php** を開いて設定を変更し、**manage.php** を上書きします。
3. ブラウザから **manage.php** にアクセスしてアップローダートップページが表示され、ホームディレクトリに **master.js** と **index.html** が配置されていれば設定変更完了です。

## Redisについて
Redisはインメモリ型データベースサーバーです。アップロード画像一覧をインメモリ(RAM上)で読み書きすることにより、ディスクI/Oを減らしアップローダー全体のパフォーマンスを向上させます。  
Redisサポート自体も試験的な為、従来のjsonファイルを直接読み書きする場合よりもパフォーマンスが低下する可能性はあります。同時保持画像枚数が500枚以上の場合、Redisによる画像一覧の読み出しの方がパフォーマンスは良い結果となりました（当方動作確認環境において）。  
Redisがインストールされていない・Redisを使用しない場合は従来通りのjsonファイルを直接読み書きによる動作をします。

## 再配布等について
再配布・転載・フォークはご自由にしていただいて構いません。
バグ修正版の公開等はこのGitHubでのみ行います。

## 動作確認環境
- Raspberry Pi 4 Model B 8GB
- nginx 1.25.2 + php-fpm
- Ubuntu Server 22.04.3 LTS
- PHP 8.2.11（+gd +mcrypt +phpredis）
- Redis 7.2

## 開発環境
- Windows 11 Pro
- TeraPad（テキストエディタ）